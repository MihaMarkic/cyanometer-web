function loaded(n,t,i,r,u,f){insertPolutionData(i,r,u,f);$(".cyan-display-main").css("visibility","hidden");$(".debug.meta li").css("visibility","hidden");$("#thumbnails-wrapper").css("visibility","hidden");$("#menu").css("visibility","hidden");showLoadingGif();var e=`/api/images/${n}/${t}`;$.ajax({url:e,dataType:"json",success:n=>{images=n.images,averageBlueness=n.averageBlueness,mainImageIndex=1,mainImage=images[mainImageIndex],populatePie(),updateMainImage(),$("#archive").attr("href",n.archiveUrl),preloadAllImages(n.images)},error:(n,t,i)=>{console.error(e,t,i.toString())}})}function updateMainImage(){highlightCurrentImage(mainImage);$("#mainLocation").text(`${mainImage.city}, ${mainImage.country} SKY`);$("#mainTakenAt").text(moment(mainImage.takenAt).format(dateMask))}function showLoadingGif(){$("#cyan-display").css("background","url(/images/loading.svg) no-repeat center");$("#cyan-display").css("height","300px");$("html, body").animate({scrollTop:0},"slow")}function preloadAllImages(n){var t=$("#thumbnails1"),i=$("#thumbnails2");n.forEach(function(r,u){loadImage(r,u,t,i,n.length)})}function loadImage(n,t,i,r,u){var e=n.thumbnailUrl,o=moment(n.takenAt).format("HH:mm"),s=`image${n.id}`,h=$(`
<div class="thumbnail-wrapper">
    <div id='${s}' class='thumbnail' style="color:white;background-image:url('${e}')" onclick="sliceClick(event, ${t})">
                <p class="time">
                    ${o}
                </div>
    </div>
</div>`),f;console.log(`Loading image ${t}`);f=t<MaxImagesPerRow?i:r;h.appendTo(f);loadedImages++;loadedImages===u&&imagesLoaded()}function imagesLoaded(){var n=new TimelineLite;$(".cyan-display-main").css("opacity","0");$(".selected-slice").css("opacity","0.5");$(".cyan-display-main").css("visibility","visible");$("#thumbnails-wrapper").css("visibility","visible");$(".debug.meta li").css("visibility","visible");$("#menu").css("visibility","visible");$("#cyan-display").css("background","white");$("#cyan-display").css("height","auto");$(".cyan-display-main").css("background",`url(${mainImage.url}) no-repeat`);n.to(".cyan-display-main",1,{opacity:1});n.staggerFrom(".debug.meta li",.3,{scale:.5,opacity:0,delay:.1,ease:Elastic.easeOut,force3D:!0},.1);n.from("#trigger",.3,{scale:.5,autoAlpha:0,transformOrigin:"50% 50%",ease:Expo.easeInOut});n.staggerFrom(".item",.2,{scale:.5,autoAlpha:0,delay:.1},.05);tlm.to(".selected-slice",.5,{opacity:1});n.staggerFrom(".cyan-display-main .time span",.3,{scale:.5,opacity:0,delay:.1,ease:Elastic.easeOut,force3D:!0},.1).staggerFrom(".cyan-display-main .blueness span",.3,{scale:.5,opacity:0,delay:.1,ease:Elastic.easeOut,force3D:!0},.1).to(".menu-trigger #blueness-label",.5,{autoAlpha:1}).to(".menu-trigger #blueness-label-suffix",.5,{autoAlpha:1}).add(tlm)}function sliceClick(n,t){n.preventDefault();console.log(`yolo on ${t}`);mainImageIndex=t;mainImage=images[t];populatePie();updateMainImage();imagesLoaded()}function populatePie(){var t=["0.5,-0.86602,0.86602,0.5,-91.5063509461097,341.5063509461096","0.86602,-0.49999,0.49999,0.86602,-91.50635094610965,158.4936490538903","1,0,0,1,0,0","0.86602,0.5,-0.5,0.86602,158.49364905389052,-91.5063509461097","0.5,0.86602,-0.86602,0.5,341.5063509461096,-91.5063509461097","0,1,-1,0,500.00000000000006,0","-0.5,0.86602,-0.86602,-0.5,591.5063509461097,158.4936490538905","-0.86602,0.5,-0.5,-0.86602,591.5063509461097,341.5063509461096","-1,0,0,-1,500,500","-0.86602,-0.49999,0.49999,-0.86602,341.5063509461097,591.5063509461097","-0.49999,-0.86602,0.86602,-0.49999,158.49364905389024,591.5063509461097","0,-1,1,0,0,500"],n=`
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="-2 -2 504 504" id="menu">
    <g id="itemsContainer">`;for(i=0;i<12;i++)n=n+createSlice(i,images[i],t[i]);n=n+`
    </g>
    <g id="trigger" class="trigger menu-trigger" role="button">
        <circle cx="250" cy="250" r="125"></circle>
        <text xmlns="http://www.w3.org/2000/svg" id="blueness-label" text-anchor="middle" alignment-baseline="central" x="250" y="235" fill="#fff">
            ?
        </text>
        <text xmlns="http://www.w3.org/2000/svg" id="blueness-label-suffix" text-anchor="middle" alignment-baseline="central" x="250" y="285" fill="#fff">
            AVERAGE BLUENESS
        </text>
        <text xmlns="http://www.w3.org/2000/svg" id="label" text-anchor="middle" alignment-baseline="auto" x="250" y="340" fill="#fff">
            -
        </text>
    </g>
</svg>`;globalPie&&(console.log("deleting existing pie"),globalPie.remove());globalPie=$(n);globalPie.appendTo($("#mainDisplay"));trigger=document.getElementById("trigger");label=trigger.querySelectorAll("#label")[0];trigger.addEventListener("click",toggleMenu,!1)}function createSlice(n,t,i){var u=parseColor(bc[t.bluenessIndex]),f=moment(t.takenAt).format(dateMask)+", blueness index "+t.bluenessIndex,r;return r=n===mainImageIndex?" selected-slice":"",`
<a onclick='sliceClick(event, ${n})' class="item" id="item-${n+1}" role="link" tabindex="0"
    transform="matrix(${i})" data-svg-origin="250 250" style='color:white'>
    <path id=image-slice-${t.id} fill='${u}' stroke="#111"
            d="M375,250 l125,0 A250,250 0 0,0 466.5063509461097,125.00000000000001 l-108.25317547305485,62.499999999999986 A125,125 0 0,1 375,250"
            class="sector${r}" >
            <title>${f}</title>
    </path>
    <use xlink:href="#icon-${n+1}" width="35" height="35" x="437.2762756347656" y="177.63037109375"
        transform="rotate(75 454.7762756347656 195.13037109375)"></use>
</a>
`}function highlightCurrentImage(n){var t="#fff";n&&(t=parseColor(bc[averageBlueness-1]));$(".menu-trigger").attr("fill",t);$(".menu-trigger #blueness-label").css("visibility","hidden");$(".menu-trigger #blueness-label-suffix").css("visibility","hidden");$(".menu-trigger #blueness-label").text(averageBlueness);$(".blueness-swatch li").removeClass("border");$(".thumbnail").removeClass("border");$(`.blueness-swatch li:nth-of-type(${n.bluenessIndex})`).addClass("border");$("#image"+n.id).addClass("border")}function closeMenu(){var n=new TimelineLite;svg=document.getElementById("menu");items=svg.querySelectorAll(".item");n.to(items,.3,{scale:0,ease:Back.easeIn},.3).to(trigger,.6,{scale:.5,transformOrigin:"50% 50%",ease:Expo.easeInOut},0);label.innerHTML="+";svg.style.pointerEvents="none"}function openMenu(){var n=new TimelineLite;svg=document.getElementById("menu");items=svg.querySelectorAll(".item");n.to(trigger,.6,{scale:1,transformOrigin:"50% 50%",ease:Expo.easeInOut},0);n.to(items,.2,{scale:1,ease:Back.easeOut.config(4)},.05);label.innerHTML="-";svg.style.pointerEvents="auto"}function toggleMenu(){label.innerHTML!=="+"?closeMenu():openMenu()}function insertPolutionData(n,t,i,r){var f="",n,u;i&&r&&(f=`
<p>
    The current level of air pollution is ${i}
    <br />
    There are increased levels of ${r}
</p>;`);switch(n){case"NO2":n=createIconCar(t);break;case"SO2":n=createIconFactory(t);break;case"PM10":n=createIconHouse(t);break;case"O3":n=createIconSun(t);break;case"LOW":n=createIconCircle(t);break;default:n=`<p>UNKNOWN AT THIS TIME</p>`}u=`
${icon}
${info}`;$(u).appendTo("#environmental-data")}var loadedImages=0,images,mainImage,mainImageIndex,averageBlueness,tlm,trigger,label,globalPie;const dateMask="DD.MM.YYYY HH:mm";tlm=new TimelineMax({repeat:-1,repeatDelay:.2,yoyo:!0});const MaxImagesPerRow=6;loadedImages=[];